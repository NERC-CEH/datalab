---
- name: Install Httpie
  apt:
    state: installed
    pkg: httpie

- name: Download dynamic-proxy compose file
  copy:
    src: files/docker-compose.yml
    dest: /home/deploy/docker-compose.yml
    force: yes

- name: Download datalabs Nginx Loadbalancer configuration file
  template:
    src: datalab.conf.j2
    dest: /home/deploy/datalab.conf
    force: yes

- name: Open Firewall ports
  ufw:
    rule: allow
    port: "{{ item }}"
    from_ip: any
    proto: tcp
  with_items: "{{ proxy_ports }}"

- name: Ensure defined images in use
  shell: docker-compose pull

- name: Start dynamic-proxy
  shell: docker-compose up -d
